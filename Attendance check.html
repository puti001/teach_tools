<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç”Ÿå‡ºç¼ºå¸­é»åè¡¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f0f0f0;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section h2 {
            margin-top: 0;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        #studentButtons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .student-button {
            padding: 10px;
            border: none;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            border-radius: 4px;
        }
        .å‡ºå¸­ { background-color: #4CAF50; color: white; }
        .ç—…å‡ { background-color: #FFC107; color: black; }
        .äº‹å‡ { background-color: #2196F3; color: white; }
        .å°šæœªè«‹å‡ { background-color: #F44336; color: white; }
        .å…¬å‡ { background-color: #9C27B0; color: white; }
        .å–ªå‡ { background-color: #607D8B; color: white; }
        .å…¶ä»– { background-color: #FF5722; color: white; }
        .output-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            #studentButtons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <h1>å­¸ç”Ÿå‡ºç¼ºå¸­é»åè¡¨</h1>
    
    <div class="section">
        <h2>1. è¼¸å…¥å€</h2>
        <label for="nameList">åº§è™Ÿå§“åæ¸…å–®:</label>
        <textarea id="nameList" rows="5" placeholder="æ¯è¡Œè¼¸å…¥ä¸€å€‹å­¸ç”Ÿåº§è™Ÿå’Œå§“åï¼Œä¾‹å¦‚ï¼š01 ç‹å°æ˜"></textarea>
        <button onclick="saveNames()">ä¿å­˜åå–®</button>
    </div>

    <div class="section">
        <h2>2. é»åå€</h2>
        <div id="studentButtons"></div>
    </div>

    <div class="section">
        <h2>3. è¼¸å‡ºå€</h2>
        <div class="output-buttons">
            <button onclick="generatePlainText()">è¼¸å‡ºç´”æ–‡å­—</button>
            <button onclick="copyToClipboard()">è¤‡è£½åˆ°å‰ªè²¼ç°¿</button>
            <button onclick="generateCSV()">è¼¸å‡º.csv</button>
            <button onclick="resetStatus()">é‡ç½®å‡ºå¸­ç‹€æ…‹</button>
        </div>
        <label for="output">è¼¸å‡ºçµæœ:</label>
        <textarea id="output" rows="6" readonly></textarea>
    </div>

    <div class="section">
        <h2>4. éƒµå¯„å€</h2>
        <label for="recipientList">æ”¶ä»¶è€…æ¸…å–®:</label>
        <textarea id="recipientList" rows="5" placeholder="æ¯è¡Œè¼¸å…¥ä¸€å€‹æ”¶ä»¶è€…éƒµç®±åœ°å€"></textarea>
        <button onclick="saveRecipients()">ä¿å­˜æ”¶ä»¶è€…</button>
        <button onclick="sendEmail()">å‚³é€åˆ°éƒµä»¶</button>
    </div>

    <audio id="buttonSound" src="https://assets.mixkit.co/active_storage/sfx/3005/3005-preview.mp3"></audio>

    <script>
        let savedNames = [];
        let attendanceStatus = [];
        let recipients = [];

        function playButtonSound() {
            document.getElementById('buttonSound').play();
        }

        function saveNames() {
            playButtonSound();
            const nameList = document.getElementById('nameList').value;
            savedNames = nameList.split('\n').filter(name => name.trim() !== '');
            localStorage.setItem('studentNames', JSON.stringify(savedNames));
            updateAttendanceStatus();
        }

        function updateAttendanceStatus() {
            attendanceStatus = savedNames.map(name => ({ name, status: 'å‡ºå¸­' }));
            renderButtons();
        }

        function renderButtons() {
            const container = document.getElementById('studentButtons');
            container.innerHTML = '';
            attendanceStatus.forEach((student, index) => {
                const button = document.createElement('button');
                button.innerHTML = `${student.name}<br>${student.status}`;
                button.className = `student-button ${student.status}`;
                button.onclick = () => {
                    playButtonSound();
                    toggleStatus(index);
                };
                container.appendChild(button);
            });
        }

        function toggleStatus(index) {
            const statuses = ['å‡ºå¸­', 'ç—…å‡', 'äº‹å‡', 'å°šæœªè«‹å‡', 'å…¬å‡', 'å–ªå‡', 'å…¶ä»–'];
            const currentIndex = statuses.indexOf(attendanceStatus[index].status);
            attendanceStatus[index].status = statuses[(currentIndex + 1) % statuses.length];
            renderButtons();
        }

        function generatePlainText() {
            playButtonSound();
            const date = new Date();
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const statusCounts = attendanceStatus.reduce((acc, student) => {
                acc[student.status] = (acc[student.status] || []).concat(student.name.split(' ')[0]);
                return acc;
            }, {});

            let reportText = `æ—¥æœŸï¼š${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ æ˜ŸæœŸ${weekdays[date.getDay()]}\n` +
                             `æ‡‰åˆ°äººæ•¸ï¼š${attendanceStatus.length}\n` +
                             `å‡ºå¸­äººæ•¸ï¼š${statusCounts['å‡ºå¸­'] ? statusCounts['å‡ºå¸­'].length : 0}\n`;

            const absenceTypes = ['ç—…å‡', 'äº‹å‡', 'å°šæœªè«‹å‡', 'å…¬å‡', 'å–ªå‡', 'å…¶ä»–'];
            absenceTypes.forEach(type => {
                if (statusCounts[type] && statusCounts[type].length > 0) {
                    reportText += `${type}äººæ•¸ï¼š${statusCounts[type].length} (${statusCounts[type].join('ã€')})\n`;
                }
            });

            document.getElementById('output').value = reportText.trim();
        }

        function generateCSV() {
            playButtonSound();
            const csvContent = [
                ['åº§è™Ÿå§“å', 'å‡ºå¸­ç‹€æ…‹'],
                ...attendanceStatus.map(s => [s.name, s.status])
            ].map(e => e.join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                const now = new Date();
                const dateString = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}`;
                link.setAttribute("href", url);
                link.setAttribute("download", `å‡ºç¼ºå¸­ç‹€æ³_${dateString}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function saveRecipients() {
            playButtonSound();
            const recipientList = document.getElementById('recipientList').value;
            recipients = recipientList.split('\n').filter(email => email.trim() !== '');
            localStorage.setItem('recipients', JSON.stringify(recipients));
            alert('æ”¶ä»¶è€…å·²ä¿å­˜');
        }

        function sendEmail() {
            playButtonSound();
            if (recipients.length === 0) {
                alert('è«‹å…ˆæ·»åŠ æ”¶ä»¶è€…');
                return;
            }
            const date = new Date();
            const formattedDate = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            const subject = encodeURIComponent(`${formattedDate}-å­¸ç”Ÿå‡ºç¼ºå¸­é€šçŸ¥`);
            const body = encodeURIComponent(document.getElementById('output').value);
            const to = recipients.join(',');
            window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
        }

        function resetStatus() {
            playButtonSound();
            attendanceStatus.forEach(student => student.status = 'å‡ºå¸­');
            renderButtons();
            alert('å·²é‡ç½®æ‰€æœ‰å­¸ç”Ÿçš„å‡ºå¸­ç‹€æ…‹ç‚º"å‡ºå¸­"');
        }

        function copyToClipboard() {
            playButtonSound();
            const outputText = document.getElementById('output').value;
            if (outputText) {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    // ç°ä»£æµè§ˆå™¨æ–¹æ³•
                    navigator.clipboard.writeText(outputText).then(() => {
                        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    }).catch(err => {
                        console.error('ä½¿ç”¨ navigator.clipboard å¤åˆ¶å¤±è´¥: ', err);
                        fallbackCopyTextToClipboard(outputText);
                    });
                } else {
                    // å¤‡é€‰æ–¹æ³•
                    fallbackCopyTextToClipboard(outputText);
                }
            } else {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // é¿å…æ»šåŠ¨åˆ°åº•éƒ¨
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿' : 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶';
                alert(msg);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }

            document.body.removeChild(textArea);
        }

        // åˆå§‹åŒ–
        const storedNames = localStorage.getItem('studentNames');
        if (storedNames) {
            savedNames = JSON.parse(storedNames);
            document.getElementById('nameList').value = savedNames.join('\n');
            updateAttendanceStatus();
        }

        const storedRecipients = localStorage.getItem('recipients');
        if (storedRecipients) {
            recipients = JSON.parse(storedRecipients);
            document.getElementById('recipientList').value = recipients.join('\n');
        }

        // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ éŸ³æ•ˆ
        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', playButtonSound);
        });
    </script>
    
    <div class="section">
        <h2>5. èªªæ˜å€</h2>
        <div style="white-space: pre-wrap;">
**ğŸŒŸ å­¸ç”Ÿå‡ºç¼ºå¸­é»åè¡¨å°å·¥å…·ä»‹ç´¹ ğŸŒŸ**
é€™æ˜¯ä¸€å€‹ç‚ºæ•™å¸«è¨­è¨ˆçš„ç¶²é å·¥å…·ï¼Œæ—¨åœ¨ç°¡åŒ–å­¸ç”Ÿå‡ºç¼ºå¸­ç®¡ç†æµç¨‹ã€‚å®ƒç”±å±æ±ç¸£å¾Œåº„åœ‹å°é»ƒè€å¸«èˆ‡ AI åŠ©æ‰‹ Claude åˆä½œé–‹ç™¼ã€‚

**åŠŸèƒ½èªªæ˜ï¼š**
1. å­¸ç”Ÿåå–®ç®¡ç†ï¼šå¯è¼¸å…¥å’Œä¿å­˜å­¸ç”Ÿçš„åº§è™Ÿå’Œå§“åã€‚
2. å‡ºç¼ºå¸­ç‹€æ…‹è¿½è¹¤ï¼šç›´è§€çš„æŒ‰éˆ•ç•Œé¢ï¼Œè¼•é¬†åˆ‡æ›å­¸ç”Ÿçš„å‡ºç¼ºå¸­ç‹€æ…‹ã€‚
3. å ±å‘Šç”Ÿæˆï¼šå¯ç”Ÿæˆç´”æ–‡å­—å ±å‘Šï¼Œæˆ–å°å‡ºç‚º CSV æ–‡ä»¶ã€‚
4. éƒµä»¶é€šçŸ¥ï¼šæ”¯æŒæ‰¹é‡ç™¼é€éƒµä»¶é€šçŸ¥çµ¦å®¶é•·æˆ–å…¶ä»–æ•™å¸«ã€‚

**è²¼å¿ƒç´°ç¯€ï¼š**
1. æœ¬åœ°å­˜å„²ï¼šå­¸ç”Ÿåå–®å’Œæ”¶ä»¶è€…æ¸…å–®æœƒä¿å­˜åœ¨ç€è¦½å™¨ä¸­ï¼Œä¸‹æ¬¡ä½¿ç”¨ç„¡éœ€é‡æ–°è¼¸å…¥ã€‚
2. æ—¥æœŸè‡ªå‹•ç”Ÿæˆï¼šCSV æ–‡ä»¶åå’Œéƒµä»¶ä¸»é¡Œæœƒè‡ªå‹•åŒ…å«ç•¶å‰æ—¥æœŸï¼Œæ–¹ä¾¿æ­¸æª”å’ŒæŸ¥æ‰¾ã€‚
3. æŒ‰éˆ•éŸ³æ•ˆï¼šæ¯æ¬¡é»æ“ŠæŒ‰éˆ•éƒ½æœƒæœ‰è¼•å¾®çš„éŸ³æ•ˆåé¥‹ï¼Œæå‡ä½¿ç”¨é«”é©—ã€‚
4. éŸ¿æ‡‰å¼è¨­è¨ˆï¼šé©é…å„ç¨®è¨­å‚™è¢å¹•å¤§å°ï¼Œæ‰‹æ©Ÿä¸Šä¹Ÿèƒ½æ–¹ä¾¿ä½¿ç”¨ã€‚
5. ç°¡æ½”ç¾è§€ï¼šç•Œé¢ç¶“éç²¾å¿ƒè¨­è¨ˆï¼Œæ—¢ç¾è§€åˆæ˜“æ–¼ä½¿ç”¨ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. è¼¸å…¥å€ï¼š
   * åœ¨æ–‡æœ¬æ¡†ä¸­è¼¸å…¥å­¸ç”Ÿåº§è™Ÿå’Œå§“åï¼Œæ¯è¡Œä¸€å€‹ï¼Œç„¶å¾Œé»æ“Š"ä¿å­˜åå–®"ã€‚
2. é»åå€ï¼š
   * é»æ“Šå­¸ç”ŸæŒ‰éˆ•åˆ‡æ›å‡ºç¼ºå¸­ç‹€æ…‹ï¼ˆå‡ºå¸­ã€ç—…å‡ã€äº‹å‡ã€å°šæœªè«‹å‡ã€å…¬å‡ã€å–ªå‡ã€å…¶ä»–ï¼‰ã€‚
3. è¼¸å‡ºå€ï¼š
   * é»æ“Š"è¼¸å‡ºç´”æ–‡å­—"ç”Ÿæˆå ±å‘Šï¼Œå¯ä»¥è¤‡è£½æˆ–å°å‡ºç‚º CSV æ–‡ä»¶ã€‚
   * ä½¿ç”¨"é‡ç½®å‡ºå¸­ç‹€æ…‹"å¯å°‡æ‰€æœ‰å­¸ç”Ÿç‹€æ…‹æ¢å¾©ç‚º"å‡ºå¸­"ã€‚
4. éƒµå¯„å€ï¼š
   * è¼¸å…¥æ”¶ä»¶è€…éƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹ï¼Œç„¶å¾Œä¿å­˜ã€‚
   * é»æ“Š"å‚³é€åˆ°éƒµä»¶"ï¼Œå°‡è‡ªå‹•æ‰“é–‹é»˜èªéƒµä»¶ç¨‹åºï¼Œç”ŸæˆåŒ…å«å ±å‘Šå…§å®¹çš„æ–°éƒµä»¶ã€‚

é€™å€‹å·¥å…·å¤§å¤§ç°¡åŒ–äº†å­¸ç”Ÿå‡ºç¼ºå¸­çš„ç®¡ç†æµç¨‹ï¼Œå¹«åŠ©æ•™å¸«æ›´é«˜æ•ˆåœ°è¿½è¹¤å­¸ç”Ÿå‡ºå‹¤ç‹€æ³ï¼Œä¸¦æ–¹ä¾¿åœ°èˆ‡å®¶é•·æˆ–å…¶ä»–æ•™å¸«é€²è¡Œæºé€šã€‚ç„¡è«–æ˜¯æ—¥å¸¸é»åé‚„æ˜¯å®šæœŸå½™å ±ï¼Œéƒ½èƒ½æ´¾ä¸Šç”¨å ´ã€‚
        </div>
    </div>

    <footer style="text-align: center; margin-top: 20px; color: #666;">
        å±æ±ç¸£å¾Œåº„åœ‹å°é»ƒè€å¸«èˆ‡AI åŠ©æ‰‹ Claude åˆä½œé–‹ç™¼ã€‚<br>
        æ›´æ–°æ—¥æœŸï¼š2024å¹´7æœˆ5æ—¥
    </footer>
</body>
</html>
